<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="description" content="untangled-js" />
  <meta charset="utf-8">
  <title>Untangled JS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="dist/untangled.client.js"></script>
  
  <link rel="stylesheet" type="text/css" href="demo/codemirror/codemirror.min.css" />
  <link rel="stylesheet" type="text/css" href="demo/codemirror/material.min.css" />
  <script type="text/javascript" src="demo/codemirror/codemirror.js"></script>
  <script type="text/javascript" src="demo/codemirror/javascript.min.js"></script>
  <script type="text/javascript" src="demo/codemirror/xml.min.js"></script>
  <script type="text/javascript" src="demo/codemirror/jsx.min.js"></script>
</head>

<body>
  <div class="wrap">
    <label for="source">Input Code</label>
    <textarea id="source"></textarea>
  </div>

  <div class="button-wrap">
    <button id="go">
      <svg>
        <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z" />
      </svg>
    </button>
  </div>

  <div class="wrap">
    <label for="target">Transpiled Code</label>
    <textarea id="target"></textarea>
  </div>
<script>

window.onload = function(){

  UntangledClient.register(`sw.js`, { scope: '/' })

  const example = `
class App extends Component {
    render() {
        return <header prop="hi">
          <h1>Hello World!</h1>
        </header>
    }
}
  `

  var cmSource = CodeMirror.fromTextArea(document.getElementById('source'), {
      mode: "jsx",
      theme: "material",
      lineNumbers: true,
      readOnly: false
  }); 
  cmSource.getDoc().setValue(example);

  var cmTarget = CodeMirror.fromTextArea(document.getElementById('target'), {
      mode: "javascript",
      theme: "material",
      lineNumbers: true,
      readOnly: true
  }); 

  var babelConfig = {
    compact: false,
    plugins: [
      ["transform-react-jsx", {pragma:'h'}]
    ],
  }

  document.getElementById('go').addEventListener('click', function(){
    UntangledClient.transform({
      code: cmSource.getDoc().getValue(),
      config: babelConfig
    })
    .then((result) => {
      cmTarget.getDoc().setValue(result);
    })
  })
  /*

  to refresh the service worker:
  
  navigator.serviceWorker.getRegistrations().then(function(registrations) {
   for(let registration of registrations) {
    registration.unregister()
  } })

  */
}

</script>

<style>
  *{
    box-sizing: border-box;
  }
  button:focus {outline:0;}
  button{cursor: pointer;}
  input:focus {outline:0;}
  html {
    position: fixed;
    width:100%;
    height:100%;
    overflow: hidden;
  }
  body {
    width:100%;
    height: 100%;
    min-height: 100vh;
    background: linear-gradient(145deg, rgb(0, 100, 109) 42%, rgb(65, 28, 206)) 0% 0% / cover;
    background-position: center center;
    background-attachment: fixed;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; 
    font-size: 15px; 
    font-style: normal; 
    font-variant: normal; 
    font-weight: 300; 
    line-height: 21px;
    letter-spacing: 0.4px;
    margin:0;
    overflow: scroll;
    color:white;
  }
  .wrap {
    width:calc(50% - 37px);
    padding:32px;
    display: inline-block;
    vertical-align: top;
  }
  textarea {
    width:100%;
    height: 300px;
    display: block;
    font-size:18px;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; 
  }
  .button-wrap{
    width:58px;
    height:300px;
    padding-top:175px;
    text-align: center;
    display: inline-block;
    vertical-align: top;
  }
  #go{
    height: 48px;
    width: 48px;
    border-radius: 100%;
    background: #263238;
    color:white;
  }
  #go:hover{
    background: black;
  }
  #go svg {
    width:24px;
    height:24px;
    fill:white;
    margin: 10px 5px;
    transform: rotate(90deg);
    transform-origin: center center;
  }
</style>
</body>
</html>